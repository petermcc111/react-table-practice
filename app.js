/** c2018 Peter Chau
    This script is transpiled and minified by babel repl 6.x
	https://babeljs.io/repl/
 */
"use strict";var _createClass=function(){function c(d,f){for(var h,g=0;g<f.length;g++)h=f[g],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(d,h.key,h)}return function(d,f,g){return f&&c(d.prototype,f),g&&c(d,g),d}}();function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(c,d){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&("object"==typeof d||"function"==typeof d)?d:c}function _inherits(c,d){if("function"!=typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);c.prototype=Object.create(d&&d.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(c,d):c.__proto__=d)}var headers=["Book","Author","Language","Published","Sales"],data=[["The Lord of the Rings","J. R. R. Tolkien","English","1954-1955","150 million"],["Le Petit Prince (The Little Prince)","Antoine de Saint-Exupery","French","1943","140 million"],["Harry Potter and the Pilosopher's Stone","J. K. Rowling","English","1997","107 million"],["And Then There Were None","Agatha Christie","English","1939","100 million"],["Dream of the Red Chamber","Cao Xueqin","Chinese","1754-1791","100 million"],["The Hobbit","J. R. R. Tolkien","English","1937","100 million"],["She: A History of Adventure","H. Rider Haggard","English","1887","100 million"]],Excel=function(c){function d(f){_classCallCheck(this,d);var g=_possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,f));return g.state={data:g.props.initialData,descending:!1,edit:null,sortby:null,search:!1},g._log=[],g.xclass=g.props.defaultClass,g._download=g._download.bind(g),g._logSetState=g._logSetState.bind(g),g._replay=g._replay.bind(g),g._save=g._save.bind(g),g._search=g._search.bind(g),g._showEditor=g._showEditor.bind(g),g._sort=g._sort.bind(g),g._toggleSearch=g._toggleSearch.bind(g),g._renderSearch=g._renderSearch.bind(g),g._renderTable=g._renderTable.bind(g),g._renderToolbar=g._renderToolbar.bind(g),console.log("loaded binding"),g}return _inherits(d,c),_createClass(d,[{key:"componentDidMount",value:function componentDidMount(){document.onkeydown=function(f){console.log("xkey"),f.altKey&&f.shiftKey&&82===f.keyCode&&this._replay()}.bind(this),console.log("componentdidmunt finished (56)")}},{key:"_download",value:function _download(f,g){var h="json"===f?JSON.stringify(this.state.data):this.state.data.reduce(function(l,m){return l+m.reduce(function(n,o,p){return n+"\""+o.replace(/"/g,"\"\"")+"\""+(p<m.length-1?",":"")},"")+"\n"},""),j=window.URL||window.webkitURL,k=new Blob([h],{type:"text/"+f});g.target.href=j.createObjectURL(k),g.target.download="data."+f}},{key:"_logSetState",value:function _logSetState(f){this._log.push(JSON.stringify(0===this._log.length?this.state:f)),this.setState(f)}},{key:"_replay",value:function _replay(){if(console.log("replay"),0===this._log.length)return void console.log("No state to replay yet");var f=1,g=setInterval(function(){f++,f==this._log.length-1&&clearInterval(g),this.setState(this._log[f])}.bind(this),1e3)}},{key:"_save",value:function _save(f){console.log("savev in"),f.preventDefault();var g=f.target.firstChild,h=this.state.data.slice();h[this.state.edit.row][this.state.edit.cell]=g.value,this.setState({edit:null,data:h}),console.log("save out")}},{key:"_search",value:function _search(f){console.log("search in");var g=f.target.value.toLowerCase();if(!g)return void this.setState({data:this._preSearchData});var h=f.target.dataset.idx,j=this._preSearchData.filter(function(k){return-1<k[h].toString().toLowerCase().indexOf(g)});this.setState({data:j}),console.log("search out")}},{key:"_showEditor",value:function _showEditor(f){this.setState({edit:{row:parseInt(f.target.dataset.row,10),cell:f.target.cellIndex}})}},{key:"_sort",value:function _sort(f){console.log("sort in");var g=f.target.cellIndex,h=this.state.data.slice(),j=this.state.sortby===g&&!this.state.descending;h.sort(function(k,l){return j?k[g]>l[g]?1:-1:k[g]<l[g]?1:-1}),this.setState({data:h,sortby:g,descending:j}),console.log("sort out")}},{key:"_toggleSearch",value:function _toggleSearch(){this.state.search?(this.setState({data:this._preSearchData,search:!1}),this._preSearchData=null):(this._preSearchData=this.state.data,this.setState({search:!0}))}},{key:"_renderSearch",value:function _renderSearch(){return this.state.search?React.createElement("tr",{onChange:this._search},this.props.headers.map(function(f,g){return React.createElement("td",{key:g},React.createElement("input",{type:"text","data-idx":g}))})):null}},{key:"_renderToolbar",value:function _renderToolbar(){return React.createElement("div",{className:"toolbar"},React.createElement("button",{onClick:this._toggleSearch,className:"toolbar"},"search"),React.createElement("button",{onClick:this._download.bind(this,"json"),href:"data.json"},"Export JSON"),React.createElement("button",{onClick:this._download.bind(this,"csv"),href:"data.csv"},"Export CSV"))}},{key:"_renderTable",value:function _renderTable(){var f=this;console.log("renderTable");var g=f.props.headers.map(function(h,j){return f.state.sortby===j&&(h+=f.state.descending?" \u2191":" \u2193"),React.createElement("th",{key:j},h)});return React.createElement("table",{className:this.xclass},React.createElement("thead",{onClick:this._sort},React.createElement("tr",null,g)),React.createElement("tbody",{onDoubleClick:this._showEditor},(this._renderSearch(),this.state.data.map(function(h,j){return React.createElement("tr",{key:j},h.map(function(k,l){var m=f.state.edit,n=m&&m.row===j&&m.cell===l?React.createElement("form",{onSubmit:f._save},React.createElement("input",{type:"text",defaultValue:k},null)):k;return React.createElement("td",{key:l,"data-row":j},n)}))}))))}},{key:"render",value:function render(){return React.createElement("div",null,this._renderToolbar(),this._renderTable())}}]),d}(React.Component);(function(){ReactDOM.render(React.createElement(Excel,{headers:headers,initialData:data,defaultClass:"table"}),document.querySelector("#app"))})();